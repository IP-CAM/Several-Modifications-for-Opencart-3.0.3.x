<modification>
<name>Always_display_categories_in_breadcrumb</name>
<code>Always_display_categories_in_breadcrumb</code>
<version>2.x-3.x</version>
<author>pensacolawebdesigns.com</author>
<link>www.pensacolawebdesigns.com</link>
 <file path="catalog/model/catalog/product.php" >
	<operation>
		<search  index="0" ><![CDATA[public function getTotalProducts($data = array()) {]]></search>
		<add position="before" ><![CDATA[
        public function getCategoriesByProductId($product_id) {
          $query = $this->db->query("SELECT pc.*, (!ISNULL(t1.parent_id) + !ISNULL(t2.parent_id) + !ISNULL(t3.parent_id) + !ISNULL(t4.parent_id) + !ISNULL(t5.parent_id))*1000 + IF(t1.sort_order>0,(1000-t1.sort_order),0) + IF(t2.sort_order>0,(1000-t2.sort_order),0) + IF(t3.sort_order>0,(1000-t3.sort_order),0) + IF(t4.sort_order>0,(1000-t4.sort_order),0) + IF(t5.sort_order>0,(1000-t5.sort_order),0) AS d FROM " . DB_PREFIX . "product_to_category pc LEFT JOIN " . DB_PREFIX . "category t1 ON t1.category_id = pc.category_id LEFT JOIN " . DB_PREFIX . "category t2 ON t1.parent_id = t2.category_id LEFT JOIN " . DB_PREFIX . "category t3 ON t2.parent_id = t3.category_id LEFT JOIN " . DB_PREFIX . "category t4 ON t3.parent_id = t4.category_id LEFT JOIN " . DB_PREFIX . "category t5 ON t4.parent_id = t5.category_id WHERE product_id = '" . (int)$product_id . "' ORDER BY d DESC");

          return $query->rows;
        }
      ]]></add>
</operation>
</file>
 <file path="catalog/controller/product/product.php" >
	<operation>
		<search ><![CDATA[public function getRecurringDescription() {]]></search>
		<add position="before" ><![CDATA[
        protected function getPath($parent_id, $current_path = '') {
					$category_info = $this->model_catalog_category->getCategory($parent_id);
				
					if ($category_info) {
						if (!$current_path) {
							$new_path = $category_info['category_id'];
						} else {
							$new_path = $category_info['category_id'] . '_' . $current_path;
						}	
					
						$path = $this->getPath($category_info['parent_id'], $new_path);
								
						if ($path) {
							return $path;
						} else {
							return $new_path;
						}
					}
				}
      ]]></add>
</operation>
	<operation>
		<search ><![CDATA[if ($product_info) {]]></search>
		<add position="after" ><![CDATA[
        if(!isset($category_info)) {
          $categories = $this->model_catalog_product->getCategoriesByProductId($this->request->get['product_id']);
          if($categories) {
            foreach($categories as $category){
              $path = $this->getPath($category['category_id']);
              $category_info = $this->model_catalog_category->getCategory($category['category_id']);
              if($path){
                $cat_path = $path;
              }else{
                $cat_path = $category_info['category_id'];
              }

              if($category_info) {
                $path = '';
                foreach (explode('_', $cat_path) as $path_id) {
                  if (!$path) {
                    $path = $path_id;
                  } else {
                    $path .= '_' . $path_id;
                  }

                  $category_info = $this->model_catalog_category->getCategory($path_id);

                  if ($category_info) {
                    $data['breadcrumbs'][] = array(
                      'text'      => $category_info['name'],
                      'href'      => $this->url->link('product/category', '&path=' . $path),
                      'separator' => $this->language->get('text_separator')
                    );
                  }
                }
                break;
              }

            }
          }
        }
      ]]></add>
</operation>
</file>
</modification>
